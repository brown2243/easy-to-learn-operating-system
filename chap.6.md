# 교착 상태

- 24/06/04 사당 투썸

## 1. 교착 상태의 개요

### 교착 상태의 정의

- 교착상태(dead lock): 2개 이상의 작업이 동시에 이뤄질 때, 다른 작업이 서로 끝나기를 기다리며 무한 대기하는 상태
- 아사현상은 잘못된 정책으로 특정 프로세스가 지연되는 반면, 교착은 자연스러운 현상으로 강제 해결해야 함
- 시스템 자원 사용, 잠금을 사용할 때 발생 가능
  - 프린터, 스캐너처럼 동시에 사용할 수 없는 자원
  - 임계구역에서 한정대기 조건 충족 못한 로직

### 자원 할당 그래프

- 프로세스가 어떤 자원을 사용하고, 어떤 자원을 기다리고 있는지 방향성 있는 그래프로 표현한 것

## 2. 교착 상태 필요조건

- 교착 상태는 아래 4가지 조건을 동시에 충족해야 발생
  - 상호 배제: 공유할 수 없는 배타적인 자원을 사용
  - 비선점: 타 프로세스가 사용중인 공유 자원을 뺏을 수 없음
  - 점유와 대기: 프로세스가 어떤 자원을 할당 받고, 다른 자원을 기다려야 함
  - 원형 대기: 점유와 대기를 하는 프로세스들이 순환적으로 서로의 자원을 요청하는 상황이 발생

## 3. 교착 상태 해결 방법

- 예방, 회피, 검출, 추가적으로 회복이 있다.
- 교착 상태 예방: 위 4가지 조건이 발생하지 않도록 무력화
  - 실효성이 없어 잘 사용 되지 않음
- 교착 상태 회피: 자원 할당량을 조절해 교착 상태 해결
  - 교착 상태 유발 가능성이 있다면 자원 할당 중지 및 관찰
  - 보장이 없어 실효성 적음
- 교착 상태 검출 및 회복:
  - 자원 할당 그래프를 모니터링 하며 교착 상태를 검출
  - 교착 상태 발생 검출 시, 교착 상태 회복
  - 현실적인 접근법

### 교착 상태 회피

- 은행원 알고리즘: 교착 상태를 예방하기 위한 자원 할당 알고리즘
  - 프로세스가 자원을 요청할 때, 시스템은 그 요청이 가용 자원 내에서 충족될 수 있는지 확인
  - 충족될 수 있다면, 시스템은 자원을 할당한 후의 상태가 안전한지 확인
  - 안전 상태라면 자원을 할당하고, 그렇지 않다면 프로세스를 대기
  - 실제 시스템에서는 사용하지 않는 이유
    - 모든 프로세스의 최대 자원 요구량을 미리 알아야 함
    - 프로세스 수와 자원 유형이 고정
    - 자원이 즉시 반환된다고 가정

### 교착 상태 검출

- 타임아웃: 일정 시간 동안 작업이 진행되지 않은 프로세스를 교착 상태로 간주

  - 간단하기에 가벼운 교착상태 검출이라 함(자원 할당 그래프 사용 시 무거운 검출)
  - 엉뚱한 프로세스가 종료 될 수 있음
  - 대중적인 운영체제에서 사용
  - 모든 시스템에 적용 불가(분산 디비)

- 일반인이 사용하는 운영체제와 다르게 공장 운영 시스템, 원자로 제어 시스템 같은 경우 교착 상태가 발생 시, 프로세스를 죽이거나 시스템 재부팅이 효율적이다.

- 체크포인트 & 롤백:체크 포인트 설정 시, 현재 시스템 상태를 디스크에 저장(snapshot) - 문제 발생 시 체크포인트로 롤백

  - 데이터베이스에서는 데이터의 일관성을 위해 잠금을 얻고 작업을 하는데, 타임아웃으로 프로세스가 종료되면 데이터에 문제가 발생할 수 있음
  - 그래서 체크포인트와 롤백을 사용

- 자원할당 그래프를 사용한 검출 방식
  - 단일 자원에서는 사이클이 발생하면 교착(그래프 내에서 시작점으로 돌아오는 경로를 의미 - 프로세스1 → 자원A → 프로세스2 → 자원B → 프로세스1)
  - 다중 자원에서는 사이클이 발생해도 교착 상태라고 판단 할 수 없음(각 자원의 )
  - 프로세스의 작업 방식을 제한하지 않으며 교착 상태 파악가능
  - 그러나 자원할당 그래프를 유지,갱신, 사이클검사등 추가 오버헤드 발생

### 교착 상태 회복
