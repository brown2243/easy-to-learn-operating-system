# 물리 메모리 관리

- 24/06/25 사당 투썸

## 1. 가상 메모리의 개요

### 가상 메모리 시스템

- 기기마다 메모리의 크기가 다를 수 있음
- 물리 메모리 크기와 메모리 위치를 신경쓰지 않고 프로그래밍 가능
- 가상 메모리 시스템에서 모든 프로세스는 0번부터 시작하는 연속된 메모리 공간을 사용
- 이는 메모리 오버레이, 스왑으로 가능해짐
  - 스왑영역: 메모리 관리자가 관리하는 하드 디스크의 영역

### 지역성

- **캐시 적중률에 관한 이론으로 중요**
- 공간의 지역성: 현재 위치에서 가까운 데이터에 접근할 확률이 높음
- 시간의 지역성: 현재 시간 기준 가까운 시간에 접근한 데이터가 사용될 확률 높음
- 순차적 지역성: 프로그램은 순차적으로 진행 됨

## 2. 페이징 기법

- 고정 분할 방식

### 페이징 기법의 구현

- 가상 주소의 메모리 주소 묶음 === 페이지, 물리 메모리에서는 프레임

### 페이징 기법의 주소 변환

- `VA = <P, D>` -> 가상주소 = page, distance(offset)
- `PA = <F, D>` -> 물리주소 = frame, distance(offset)
- 페이지 테이블을 이용해 가상 주소를 물리 주소로 변환
  - page로 frame에 접근
  - 페이지 테이블 엔트리: 페이지 번호, 프레임 번호 한줄
  - page와 offset은 몫과 나머지로 처리

### 페이지 테이블 관리

- 프로세스마다 페이지 테이블을 가짐
- 페이지 테이블은 빨리 접근이 가능해야 함
  - PCB에 있는 페이지 테이블 주소를 페이지 테이블 기준 레지스터에 저장
- 변환 색인 버퍼(Translation Lookaside Buffer, TLB)

  - CPU에 내장된 캐시
  - 최근에 사용된 페이지 테이블 엔트리를 저장

- 역 페이지 테이블

  - 프레임을 기준으로 테이블을 생성
  - 프레임 당 PID, 페이지를 저장
  - 메모리 접근 시, PID와 페이지를 테이블을 순회하며 찾아야 함
  - 하나의 테이블을 모든 프로세스가 공유

- 다단계 페이지 테이블
  - 이 방식은 기존의 단일 단계 페이지 테이블의 한계를 극복하고 메모리를 더 효율적으로 사용

## 3. 세그먼테이션 기법

- 가변 분할 방식

### 세그먼테이션 기법의 구현

- 세그먼테이션 테이블 사용
- limit(세그먼트 크기), address(물리 메모리 시작 주소)
- `VA = <S, D>` -> 가상주소 = 세그먼트 번호, 디스턴스

## 4. 캐시 매핑 기법

### 캐시 직접 매핑

- 메모리 N개의 페이지, 캐시 M개의 페이지(N >>> M)
- 메모리를 캐시로 나눔 -> 블록 = 메모리 / 캐시
- 블록 번호를 태그, 거리는 bd(block distance)
- 메모리를 블록으로 나눠 1블록에 해당하는 데이터는 1블록 캐시에만 저장
- 같은 블록의 데이터는 같은 캐시 위치에 저장 되므로 태그만 확인하면 됨
- 자리 다툼(conflict) 가능성이 높음 (서로 다른 메모리 위치가 같은 캐시 위치에 매핑될 수 있음)

### 캐시 연관 매핑

- 메모리가 캐시의 어느위치에도 자유롭게 올라갈 수 있음
- hit, miss 체크하려면 캐시를 순회해야 함

### 캐시 집합 연관 매핑

- 캐시 집합 연관 매핑은 직접 매핑과 완전 연관 매핑의 장점을 결합한 방식
- 캐시를 K개의 집합으로 나누고 각 집합에 캐시 직접 매핑 사용
- 블록에서 사용할 수 있는 캐시 공간이 1개 이상이 되어 자리다툼 완화
  - 2way, 4way ~~~
